#!/bin/sh -eu

cast_audio () {
    pacat --format=float32le --rate=24000 --channels=1
}

cast_subcarrier () {
    nice ./fm-subcarrier-raw-tx -f 64000 -v 3000 |
    jack-stdin system:playback_1 -b 16 -L -S 192000
}

cd "`dirname $0`"
tmpfile=`mktemp --tmpdir tmp.XXXXXXXXXX.raw`
ln -sf /dev/stdout $tmpfile

stdbuf -oL ssh -T ${1:-irc-source} |
    minimodem --tx-carrier --float-samples -t 100 -R 24000 --ascii -f $tmpfile |
    cast_${CAST:-subcarrier}
